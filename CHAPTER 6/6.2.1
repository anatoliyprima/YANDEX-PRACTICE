Соорудите для Flyway три SQL-файла, которые создадут:



1. таблицы order_product, orders, product:

V01__create_tables.sql

create table order_product
(
    quantity integer not null,
    order_id bigint not null,
    product_id bigint not null

);

create table orders
(
    id bigint generated by default as identity,
    date_created date,
    status varchar(255)
);

create table product
(
    id bigint generated by default as identity,
    name varchar(255) not null,
    picture_url varchar(255),
    price double precision
);

V02__create_users.sql
CREATE USER read_user;
CREATE USER write_user;
CREATE USER admin_user SUPERUSER;


2. изменения в таблице product размера колонки name на 20, а колонки picture_url на 100
http://sniptools.com/databases/resize-a-column-in-a-postgresql-table-without-changing-data/

R__alter_table.sql
ALTER TABLE product ALTER COLUMN name TYPE varchar(20), ALTER COLUMN picture_url TYPE varchar(100);


выдачу прав read_user — на чтение, write_user — чтение и запись, а admin_user — все привилегии в нашей базе
!! перед выдачей прав необходимо создать пользователей read_user, write_user, admin_user !!

R__users_access.sql
GRANT SELECT ON ALL TABLES in schema_public to read_user;
GRANT INSERT ON ALL TABLES in schema_public to write_user;
GRANT ALL PRIVILEGES ON ALL TABLES in schema_public to admin_user;


проверить выданные права можно:
SELECT table_catalog, table_schema, table_name, privilege_type FROM information_schema.table_privileges WHERE grantee = 'read_user';
